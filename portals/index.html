<!DOCTYPE html>
  <html>
    <head>
      <title>Deku documentation</title>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width">
      <link rel="stylesheet" href="../style.css">
      <script type="module">
        import { main } from "../bundle.js";
        main({"startsWith":"Portals","slug":"/purescript-deku/"})();
      </script>
    </head><body  data-deku-ssr--648823="true"><div  data-deku-ssr--517285="true"><div  data-deku-ssr--34570="true"><span  data-deku-ssr-448145="true"><a style"cursor:pointer;" href"/purescript-deku/" data-deku-ssr-930860="true"><!---586426-->Home</a><span style"" data-deku-ssr--200254="true"><!--282461--> | </span></span><span  data-deku-ssr-668633="true"><a style"cursor:pointer;" href"/purescript-deku/hello/" data-deku-ssr--848653="true"><!---365938-->Hello world</a><span style"" data-deku-ssr-20234="true"><!--502949--> | </span></span><span  data-deku-ssr-889121="true"><a style"cursor:pointer;" href"/purescript-deku/simple/" data-deku-ssr--628165="true"><!---145450-->Component</a><span style"" data-deku-ssr-240722="true"><!--723437--> | </span></span><span  data-deku-ssr--890392="true"><a style"cursor:pointer;" href"/purescript-deku/pursx1/" data-deku-ssr--407677="true"><!--75038-->Pursx 1</a><span style"" data-deku-ssr-461210="true"><!--943925--> | </span></span><span  data-deku-ssr--669904="true"><a style"cursor:pointer;" href"/purescript-deku/events1/" data-deku-ssr--187189="true"><!--295526-->Events 1</a><span style"" data-deku-ssr-681698="true"><!---835588--> | </span></span><span  data-deku-ssr--449416="true"><a style"cursor:pointer;" href"/purescript-deku/effects/" data-deku-ssr-33299="true"><!--516014-->Effects</a><span style"" data-deku-ssr-902186="true"><!---615100--> | </span></span><span  data-deku-ssr--228928="true"><a style"cursor:pointer;" href"/purescript-deku/pursx2/" data-deku-ssr-253787="true"><!--736502-->Pursx 2</a><span style"" data-deku-ssr--877327="true"><!---394612--> | </span></span><span  data-deku-ssr--8440="true"><a style"cursor:pointer;" href"/purescript-deku/events2/" data-deku-ssr-474275="true"><!--956990-->Events 2</a><span style"" data-deku-ssr--656839="true"><!---174124--> | </span></span><span  data-deku-ssr-212048="true"><a style"cursor:pointer;" href"/purescript-deku/portals/" data-deku-ssr-694763="true"><!---822523-->Portals</a><span style"" data-deku-ssr--436351="true"><!--46364--> | </span></span><span  data-deku-ssr-432536="true"><a style"cursor:pointer;" href"/purescript-deku/ssr/" data-deku-ssr-915251="true"><!---602035-->SSR</a><span style"display:none;" data-deku-ssr--215863="true"><!--266852--> | </span></span></div><div  data-deku-ssr-653024="true"><div data-deku-ssr--574633="true">
  <h1>Portals</h1>

  <h2>Zapping from place to place</h2>
  <p>
    Sometimes, we have referentially opaque nodes like videos or audio that we can't destroy and recreate when they need to move around the DOM. In these cases, we can use portals to "zap" nodes from one part of the DOM to another.
  </p>

  <p>
    The code below uses portals to flip two videos across a boundary. If you press play on either video, you'll see that it keeps playing uninterrupted, event when it is removed and reinserted.
  </p>

  <span style="display:contents;" data-deku-elt-internal="code@-478090"><pre  data-deku-ssr--381547="true"><code  data-deku-ssr-101168="true"><!--583883-->module Main where

import Prelude

import Control.Alt ((&#60;|&#62;))
import Data.Foldable (oneOfMap)
import Data.Profunctor (lcmap)
import Data.Tuple.Nested ((/\), type (/\))
import Data.FastVect.FastVect (index, (:))
import Data.FastVect.FastVect as V
import Deku.Attribute ((:=))
import Deku.Control (portal, switcher, text_)
import Deku.DOM as D
import Deku.Toplevel (runInBody1)
import Effect (Effect)
import FRP.Event (Event, bang, bus, fold, mapAccum)
import Type.Prelude (Proxy(..))

counter :: forall a. Event a &#8594; Event (a /\ Int)
counter event = mapAccum f event 0
  where
  f a b = (b + 1) /\ (a /\ b)

main :: Effect Unit
main = runInBody1
  ( bus \push -&#62; lcmap  (bang unit &#60;|&#62; _) \event -&#62; do
      portal
        ( map
            ( \i -&#62; D.video
                (oneOfMap bang [ D.Controls := "true", D.Width := "250" ])
                [D.source
                    (oneOfMap bang [ D.Src := i, D.Xtype := "video/mp4" ])
                    []
                ]
            )
            ( "https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4"
                : "https://www.w3schools.com/jsref/movie.mp4"
                : V.empty
            )
        )
        \v _ -&#62; do
          let
            p0 = index (Proxy :: _ 0) v
            p1 = index (Proxy :: _ 1) v
            ev = fold (const not) event
            flips = switcher (if _ then p0 else p1) &#60;&#60;&#60; ev
          D.div_
            [ D.button (bang $ D.OnClick := push unit)
                [ text_ "Switch videos" ]
            , D.div_ [ D.span_ [flips true], D.span_ [flips false] ]
            ]
  )
</code></pre></span>

  <p>And here's what it produces:</p>

  <blockquote> <span style="display:contents;" data-deku-elt-internal="result@-478090"><div  data-deku-ssr-418199="true"><button  data-deku-ssr-900914="true"><!---616372-->Switch videos</button><div  data-deku-ssr--230200="true"><span  data-deku-ssr-252515="true"><video controls"true" width"250" data-deku-ssr--257602="true"><source src"https://www.w3schools.com/jsref/movie.mp4" type"video/mp4" data-deku-ssr-225113="true"></source></video></span><span  data-deku-ssr--685513="true"><video controls"true" width"250" data-deku-ssr--933403="true"><source src"https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4" type"video/mp4" data-deku-ssr--450688="true"></source></video></span></div></div></span> </blockquote>

  <h2>Events of portals</h2>

  <p>Portals work by sending a referentially-opaque reference to a DOM element into a closure where it can be safely used. Whenever an event is emitted containing the element, the element will be rendered at that place in the DOM, as in the example above. Note that portals "hog the blanket", meaning that they end up in the last place in which they were called.</p>

  <p><code>switcher</code> is a <a href="https://github.com/mikesol/purescript-deku/blob/ff3e2d2dc89b39088c5d5d6ab3492fb8730dd9a4/src/Deku/Control.purs#L325">small function</a> included in Deku to switch between different elements in an enclosure. It's how the tabs in this documentation are implemented as well.</p>

  <h2>Next steps</h2>
  <p>In this section, we used portals to move an element to different areas of the DOM. In the next section, we'll learn how to do <a data-deku-attr-internal="next@-478090" style="cursor:pointer;">static site rendering</a>.</p>
</div></div></div></body></html>
