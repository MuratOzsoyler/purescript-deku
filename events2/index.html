<!DOCTYPE html>
  <html>
    <head>
      <title>Deku documentation</title>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width">
      <link rel="stylesheet" href="../style.css">
      <script type="module">
        import { main } from "../bundle.js";
        main({"startsWith":"Events2","slug":"/purescript-deku/"})();
      </script>
    </head><body  data-deku-ssr--648823="true"><div  data-deku-ssr--517285="true"><div  data-deku-ssr--34570="true"><span  data-deku-ssr-448145="true"><a style"cursor:pointer;" href"/purescript-deku/" data-deku-ssr-930860="true"><!---586426-->Home</a><span style"" data-deku-ssr--200254="true"><!--282461--> | </span></span><span  data-deku-ssr-668633="true"><a style"cursor:pointer;" href"/purescript-deku/hello/" data-deku-ssr--848653="true"><!---365938-->Hello world</a><span style"" data-deku-ssr-20234="true"><!--502949--> | </span></span><span  data-deku-ssr-889121="true"><a style"cursor:pointer;" href"/purescript-deku/simple/" data-deku-ssr--628165="true"><!---145450-->Component</a><span style"" data-deku-ssr-240722="true"><!--723437--> | </span></span><span  data-deku-ssr--890392="true"><a style"cursor:pointer;" href"/purescript-deku/pursx1/" data-deku-ssr--407677="true"><!--75038-->Pursx 1</a><span style"" data-deku-ssr-461210="true"><!--943925--> | </span></span><span  data-deku-ssr--669904="true"><a style"cursor:pointer;" href"/purescript-deku/events1/" data-deku-ssr--187189="true"><!--295526-->Events 1</a><span style"" data-deku-ssr-681698="true"><!---835588--> | </span></span><span  data-deku-ssr--449416="true"><a style"cursor:pointer;" href"/purescript-deku/effects/" data-deku-ssr-33299="true"><!--516014-->Effects</a><span style"" data-deku-ssr-902186="true"><!---615100--> | </span></span><span  data-deku-ssr--228928="true"><a style"cursor:pointer;" href"/purescript-deku/pursx2/" data-deku-ssr-253787="true"><!--736502-->Pursx 2</a><span style"" data-deku-ssr--877327="true"><!---394612--> | </span></span><span  data-deku-ssr--8440="true"><a style"cursor:pointer;" href"/purescript-deku/events2/" data-deku-ssr-474275="true"><!--956990-->Events 2</a><span style"" data-deku-ssr--656839="true"><!---174124--> | </span></span><span  data-deku-ssr-212048="true"><a style"cursor:pointer;" href"/purescript-deku/portals/" data-deku-ssr-694763="true"><!---822523-->Portals</a><span style"" data-deku-ssr--436351="true"><!--46364--> | </span></span><span  data-deku-ssr-432536="true"><a style"cursor:pointer;" href"/purescript-deku/ssr/" data-deku-ssr-915251="true"><!---602035-->SSR</a><span style"display:none;" data-deku-ssr--215863="true"><!--266852--> | </span></span></div><div  data-deku-ssr-653024="true"><div data-deku-ssr--574633="true">
  <h1>Events 2</h1>

  <h2>Dynamic children</h2>
  <p>
    Up until now, our DOM has been static. This is OK in some cases, but in many cases, we need a dynamic DOM: one whose elements are inserted and removed based on user interaction. In Deku, we achieve this with <code>Event</code>-s.
  </p>

  <p>
    The code below creates a todo list that allows a user to add, prioritize, and remove elements.
  </p>

  <span style="display:contents;" data-deku-elt-internal="code@-478090"><pre  data-deku-ssr--381547="true"><code  data-deku-ssr-101168="true"><!--583883-->module Main where

import Prelude

import Control.Alt ((&#60;|&#62;))
import Data.Filterable (filterMap)
import Data.Foldable (for_, oneOfMap)
import Data.Maybe (Maybe(..))
import Data.Profunctor (lcmap)
import Data.Tuple.Nested ((/\))
import Deku.Attribute (cb, (:=))
import Deku.Control (text_)
import Deku.Core (Child(..), dyn)
import Deku.DOM as D
import Deku.Toplevel (runInBody1)
import Effect (Effect)
import FRP.Event (bang, bus, keepLatest, mapAccum)
import Web.Event.Event (target)
import Web.HTML.HTMLInputElement (fromEventTarget, value)
import Web.UIEvent.KeyboardEvent (code, fromEvent)

data MainUIAction
  = UIShown
  | AddTodo
  | ChangeText String

data TodoAction = Prioritize | Delete

main :: Effect Unit
main = runInBody1
  ( bus \push -&#62; lcmap (bang UIShown &#60;|&#62; _) \event -&#62; do
      let
        top =
          [ D.input
              ( oneOfMap bang
                  [ D.OnInput := cb \e -&#62; for_
                      ( target e
                          &#62;&#62;= fromEventTarget
                      )
                      ( value
                          &#62;=&#62; push &#60;&#60;&#60; ChangeText
                      )
                  , D.OnKeyup := cb
                      \e -&#62; for_ (fromEvent e) \evt -&#62; do
                        when (code evt == "Enter") $ do
                          push AddTodo
                  ]
              )
              []
          , D.button
              (bang $ D.OnClick := push AddTodo)
              [ text_ "Add" ]
          ]
      D.div_
        [ D.div_ top
        , D.div_
            [ dyn $
                map
                  ( \txt -&#62; keepLatest $ bus \p' e' -&#62;
                      ( bang $ Insert $ D.div_
                          [ text_ txt
                          , D.button
                              ( bang
                                  $ D.OnClick := p' SendToTop
                              )
                              [ text_ "Prioritize" ]
                          , D.button
                              ( bang
                                  $ D.OnClick := p' Remove
                              )
                              [ text_ "Delete" ]
                          ]
                      ) &#60;|&#62; e'
                  )
                  ( filterMap
                      ( \(tf /\ s) -&#62;
                          if tf then Just s else Nothing
                      )
                      ( mapAccum
                          ( \a b -&#62; case a of
                              ChangeText s -&#62; s /\ (false /\ s)
                              AddTodo -&#62; b /\ (true /\ b)
                              _ -&#62; "" /\ (false /\ "")
                          )
                          event
                          ""
                      )
                  )
            ]
        ]
  )
</code></pre></span>

  <p>And here's what it produces:</p>

  <blockquote> <span style="display:contents;" data-deku-elt-internal="result@-478090"><div  data-deku-ssr--933403="true"><div  data-deku-ssr--450688="true"><input style"border-style:solid;border-width: 1px;border-color: black;" data-deku-ssr-32027="true"></input><button style"margin: 5px;" data-deku-ssr-514742="true"><!--997457-->Add</button></div><div  data-deku-ssr--616372="true"></div></div></span> </blockquote>

  <h2>Events of events</h2>

  <p>In the previous sections, DOM element constructors like <code>div_</code> could only accept an <code>Array</code>. They <i>also</i> can accept an event of events. In this case, the outer event represents a dynamic element, and the inner event represents the <i>stage</i> of dynamism with a data type called <code>Child</code>. <code>Child</code> has three constructors:</p>

  <ul>
    <li><code>insert</code>, which takes an element.</li>
    <li><code>sendToTop</code>, which sends the current element to the top of its parent.</li>
    <li><code>remove</code>, which removes the element from its parent.</li>
  </ul>

  <p>The Deku engine listens for these in a specific order. <code>Insert</code> can be followed by 0 or more <code>SendToTop</code>-s. When a <code>Remove</code> is called, the stream is unsubscribed from the parent. Because we're in the land of <code>Event</code>-s, you can emit anything, but this is the how they will be listened to.</p>

  <h2>Next steps</h2>
  <p>In this section, we used nested events to insert and remove elements from a parent. In the next section, we'll see how we can use <a data-deku-attr-internal="next@-478090" style="cursor:pointer;">portals to move an element to a different place of the DOM</a>.</p>
</div></div></div></body></html>
